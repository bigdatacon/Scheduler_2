<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Gantt Charts</title>
    <style>
        .chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        .gantt {
            width: 90%;
            height: 400px;
        }
        svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div class="chart" id="machine-chart">
    <h2>Processing Time vs Machine</h2>
    <div class="gantt" id="machine-gantt"></div>
</div>
<div class="chart" id="job-chart">
    <h2>Processing Time vs Jobs</h2>
    <div class="gantt" id="job-gantt"></div>
</div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const machineGantt = d3.select('#machine-gantt');
        const jobGantt = d3.select('#job-gantt');

        // Пример данных из JSON
        const data = {
            ms_operations: [
                { "Job": 1, "Machine": 1, "Start": 0, "Finish": 36 },
                { "Job": 1, "Machine": 1, "Start": 144, "Finish": 166 },
                { "Job": 1, "Machine": 2, "Start": 36, "Finish": 64 },
                { "Job": 1, "Machine": 2, "Start": 64, "Finish": 107 },
                { "Job": 1, "Machine": 2, "Start": 107, "Finish": 144 }
            ],
            js_operations: [
                { "Job": 1, "Machine": 1, "Start": 0, "Finish": 36 },
                { "Job": 1, "Machine": 2, "Start": 36, "Finish": 64 },
                { "Job": 1, "Machine": 2, "Start": 64, "Finish": 107 },
                { "Job": 1, "Machine": 2, "Start": 107, "Finish": 144 },
                { "Job": 1, "Machine": 1, "Start": 144, "Finish": 166 }
            ]
        };

        const machineData = data.ms_operations;
        const jobData = data.js_operations;

        // Проверка количества jobs и машин
        if (jobData.length !== 5 || machineData.length !== 5) {
            console.error('Ошибка: данные не соответствуют ожидаемому формату.');
            return;
        }

        drawGanttChart(machineGantt, machineData, 'Machine', 'Job');
        drawGanttChart(jobGantt, jobData, 'Job', 'Machine');
    });

    function drawGanttChart(container, data, groupKey, labelKey) {
        const margin = { top: 20, right: 20, bottom: 20, left: 40 };
        const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
        const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

        const svg = container.append('svg')
            .attr('viewBox', `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
            .attr('preserveAspectRatio', 'xMinYMin meet')
            .append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        const x = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.Finish)])
            .range([0, width]);

        const y = d3.scaleBand()
            .domain([...new Set(data.map(d => d[groupKey]))])
            .range([0, height])
            .padding(0.1);

        const color = d3.scaleOrdinal(d3.schemeCategory10);

        svg.append('g')
            .attr('class', 'x-axis')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));

        svg.append('g')
            .attr('class', 'y-axis')
            .call(d3.axisLeft(y));

        const bars = svg.selectAll('.bar')
            .data(data)
            .enter()
            .append('g')
            .attr('class', 'bar-group');

        bars.append('rect')
            .attr('class', 'bar')
            .attr('x', d => x(d.Start))
            .attr('y', d => y(d[groupKey]))
            .attr('width', d => x(d.Finish) - x(d.Start))
            .attr('height', y.bandwidth())
            .attr('fill', d => color(d[labelKey]));

        bars.append('text')
            .attr('x', d => x(d.Start) + (x(d.Finish) - x(d.Start)) / 2)
            .attr('y', d => y(d[groupKey]) + y.bandwidth() / 2)
            .attr('dy', '.35em')
            .attr('text-anchor', 'middle')
            .attr('fill', 'white')
            .text(d => d[labelKey]);
    }
</script>
</body>
</html>